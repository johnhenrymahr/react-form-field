# Form/Field Component

Simple component to help with forms.

## Goals

To avoid re-rendering the entire form on each change event, ie user keystroke, etc,
but still allow form level validation and some other useful features.

## Usage

```jsx
<Form onSubmit={ onSubmitHandler } >
  <p>Anything can be a child of Form</p>
  <Field
    className="my-form"
    name="testField"
    validate={ (name, value) => Boolean(value) }
   >
   <!-- Notice the child is a function that returns a component-->
    {
      ({ setFieldValueHandler, valid, validated, validateFieldHandler, value }) => (
        <input
          aria-invalid={validated && !valid}
          value={value}
          onChange={setFieldValueHandler}
          onBlur={validateFieldHandler}
        />
      )
    }
   </Field>
   <input type="submit" name="submit" value="Submit Form" />
</Form>
```

### Form

Form creates a (html) form element and passes down props. It will clone any immediate (first level) descendants that are instances of Field and pass some special props to the Field. Other types of descendants will be untouched.

There is a special prop called derivedProps. If provided (a function) it will be called with the current state with the expectation that the function will return an object of props which will then be merged into the form props. Not the greatest I know, but the only simple way I could figure out how to allow props to be based on current state.

#### Form Props

- **derivedProps** (described above) (function), returns object of props

- **isDisabled** (boolean) if true submit handler will not run

- **onSubmit** (function) called only if form passes submit validation. Can be async (return a promise). Arguments

  1. form value map { Field.name: Field.value }
  2. the form event object (if available)

- **onValidationError** (function) called only when form FAILS validation. Can be async. Arguments.

  1. form value map { Field.name: Field.value }
  2. array of invalid field names
  3. the form event object (if available)

-- **validate** (function) validation function to be passed to each Field child. _note:_ If a validation function is passed directly to a Field component that validation function will take precedence over the the passed in at the Form level. See validation bellow for more details.

#### state

- **isSubmitting** (boolean) set to true before submit handler runs and set to false after the appropriate handler runs (if the form is still mounted at that point).

### Field

Field will only really work if it is a first level descendant of Form. So keep that in mind.
Field uses the child props as a function pattern (which I guess is a pattern). So it expects its children prop to be a (single) function. It passes a argument with some props to use when rendering the actual form input. I am calling these props the child props.

#### Field Props

- **autoFill** (function) _Child Prop_ passed by Form. Invoke to update another Field in the Form. (Field.name, Field.value)

- **initialValue** (number || string) if passed will be sent trough validation and set to Field state as value

- **isDisabled** (boolean) _Child Prop_ passed by Form, true if Form is disabled

- **isSubmitting** (boolean) _Child Prop_ passed by Form, true if Form is submitting, can use to disable submit button when Form is submitting.

- **name** (string) _required_ field name

- **onFieldUpdate** (function) use in conjunction with validateFieldHandler, one that runs validation and sets result to state this function will be called with the following object of child props:

  - autoFill
  - isDisabled
  - isSubmitting
  - name
  - updateField
  - isValid
  - isValidated
  - value
  - validationMessage

- **registerGetter** (function) supplied by Form. Form uses this to get a Field value.

- **registerUpdater** (function) supplied by Form. Allows Form to update Field state (for autoFill).

- **shouldRegister** (boolean) (default: true) if set to false Field will not register with Form. It will still get child props passed to it, but its value will not be a part of Form Data passed to **onSubmit**. Useful for submit buttons and such.

- **unregister** (function) provided by Form, when a field is removed (because of form composition change) it removes its handlers from Form.

- **normalize** (function) called with value as only argument after validation, before the value is written to state. Provides an opportunity to format the user input when required.

- **validate** (function) validation function to run again Field value. See bellow.

- **valueSelector** (function) function to return value from Event Object. Defaults to event.target.value. Passed event Object.

#### Derived Child Props

These are in addition to props marked as child above. They are generated by Field.

- **setFieldValueHandler** (event handler function) this handler does not run validation, it just sets the field value to the Field state. Useful for an onChange handler when you only want to validate onBlur. But as we are using React controlled components we need to keep the state value in sync onChange as well as onBlur.

- **updateField** (function) the state updater method. Runs validation and sets value. You can call directly if need to for some reason.

- **validateFieldHandler** (event handler function) calls validate function (if provided) and sets to state, then calls **onFieldUpdate** function (if provided).

- **isValid** (boolean) if Field has passed validation.

- **isValidated** (boolean) if Field has ever been validated.

- **value** (string || number) current Field value.

- **validationMessage** (string || function || React element) validation error message potentially returned from the validate method.

### Validate

Validate is a function prop that can be passed in to the Form level or at the Field level.

#### Arguments

1. Field.name
2. Field.value (current value)

#### Return value

The isValid and validationMessage state props will be set based on the type returned from the validate function:

1. **boolean:** Return value set to isValid, validationMessage is set to an empty string.
2. **null:** isValid set to false, validationMessage set to an empty string.
3. **string:** isValid set to opposite of string boolean value (empty string becomes isValid: true). validationMessage is set to the return value
4. **function:** isValid will be set to false, validationMessage will be set to return value
5. **React Element:** (passes React.isValidElement check) isValid will be set to false, validationMessage is set to the return value.
